<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-5">
      <!-- パンくず -->
      <span>
        <%= link_to "マイページ", mypage_users_path %> > 会員情報の編集
      </span>
      <!-- タイトル -->
      <h1 class="mt-3 mb-3">会員情報の編集</h1>
      <hr>

      <!-- 会員情報編集フォーム -->
      <%= form_with model:@user, url: mypage_users_path, local: true, method: :put do |f| %>
        <!-- 氏名情報 -->
        <div class="form-group">
          <div class="d-flex justify-content-between">
            <%= f.label :name, "氏名", class: "text-md-left nagoyameshi-edit-user-info-label" %>
            <span onclick="switchEditUserInfo('.userName', '.editUserName', '.userNameEditLabel');" class="userNameEditLabel user-edit-label">
              編集
            </span>
          </div>
          <!-- 編集ボタン押す前　氏名を表示 -->
          <div class="collapse show userName">
            <h1 class="nagoyameshi-edit-user-info-value"><%= @user.name %></h1>
          </div>
          <!-- 編集ボタン押した後　氏名編集フォームを表示 -->
          <div class="collapse editUserName">
            <%=
              f.text_field :name,
              class: "form-control",
              autofocus: "true",
              required: "true",
              autocomplete: "on",
              placeholder: "名前を入力"
            %>
            <%= f.submit "保存", class: "btn nagoyameshi-submit-button mt-2 w-25" %>

            <% if @user.errors.messages[:name].present? %>
              <span class="invalid-feedback" role="alert">
                <strong>氏名を入力してください</strong>
              </span>
            <% end %>
          </div>
        </div>
        <hr>

        <!-- フリガナ情報 -->
        <div class="form-group">
          <div class="d-flex justify-content-between">
            <%= f.label :name, "フリガナ", class: "text-md-left nagoyameshi-edit-user-info-label" %>
            <span onclick="switchEditUserInfo('.userKana', '.editUserKana', '.userKanaEditLabel');" class="userKanaEditLabel user-edit-label">
              編集
            </span>
          </div>
          <!-- 編集ボタン押す前　フリガナを表示 -->
          <div class="collapse show userKana">
            <h1 class="nagoyameshi-edit-user-info-value"><%= @user.kana %></h1>
          </div>
          <!-- 編集ボタン押した後　フリガナ編集フォームを表示 -->
          <div class="collapse editUserKana">
            <%=
              f.text_field :kana,
              class: "form-control",
              autofocus: "true",
              required: "true",
              autocomplete: "on",
              placeholder: "フリガナを入力"
            %>
            <%= f.submit "保存", class: "btn nagoyameshi-submit-button mt-2 w-25" %>

            <% if @user.errors.messages[:kana].present? %>
              <span class="invalid-feedback" role="alert">
                <strong>フリガナを入力してください</strong>
              </span>
            <% end %>
          </div>
        </div>
        <hr>

        <!-- 性別情報 -->
        <div class="form-group">
          <div class="d-flex justify-content-between">
            <%= f.label :gender, "性別", class: "text-md-left nagoyameshi-edit-user-info-label" %>
            <span onclick="switchEditUserInfo('.userGender', '.editUserGender', '.userGenderEditLabel');" class="userGenderEditLabel user-edit-label">
              編集
            </span>
          </div>
          <!-- 編集ボタン押す前　性別を表示 -->
          <div class="collapse show userGender">
            <h1 class="nagoyameshi-edit-user-info-value"><%= @user.gender %></h1>
          </div>
          <!-- 編集ボタン押した後　性別編集フォームを表示 -->
          <div class="collapse editUserGender">
            <div>
              <%= f.radio_button :gender, :male, checked: true %>
              <%= f.label :gender, "男性", {value: :male, style: "display: inline-block; margin-right: 30px"} %>
              <%= f.radio_button :gender, :female %>
              <%= f.label :gender, "女性", {value: :female, style: "display: inline-block;"} %>
            </div>
            <%= f.submit "保存", class: "btn nagoyameshi-submit-button mt-3 w-25" %>

            <% if @user.errors.messages[:gender].present? %>
              <span class="nagoyameshi-error-message">
                <strong><%= @user.errors.full_messages_for(:gender).first %></strong>
              </span>
            <% end %>
          </div>
        </div>
        <hr>

        <!-- 生年月日情報 -->
        <div class="form-group">
          <div class="d-flex justify-content-between">
            <%= f.label :birthday, "生年月日", class: "text-md-left nagoyameshi-edit-user-info-label" %>
            <span onclick="switchEditUserInfo('.userBirthday', '.editUserBirthday', '.userBirthdayEditLabel');" class="userBirthdayEditLabel user-edit-label">
              編集
            </span>
          </div>
          <!-- 編集ボタン押す前　生年月日を表示 -->
          <div class="collapse show userBirthday">
            <h1 class="nagoyameshi-edit-user-info-value"><%= @user.birthday %></h1>
          </div>
          <!-- 編集ボタン押した後　生年月日編集フォームを表示 -->
          <div class="collapse editUserBirthday">
            <div>
              <%= f.date_select :birthday, {start_year: 1950, end_year: (Time.now.year - 5),
              include_blank: true, use_two_digit_numbers: true},
              {class: "nagoyameshi-login-input"}%>
            </div>
            <%= f.submit "保存", class: "btn nagoyameshi-submit-button mt-3 w-25" %>

            <% if @user.errors.messages[:birthday].present? %>
              <span class="nagoyameshi-error-message">
                <strong><%= @user.errors.full_messages_for(:birthday).first %></strong>
              </span>
            <% end %>
          </div>
        </div>
        <hr>

        <!-- メールアドレス情報 -->
        <div class="form-group">
          <div class="d-flex justify-content-between">
            <%= f.label :email, "メールアドレス", class: "text-md-left nagoyameshi-edit-user-info-label" %>
            <span onclick="switchEditUserInfo('.userMail', '.editUserMail', '.userMailEditLabel');" class="userMailEditLabel user-edit-label">
              編集
            </span>
          </div>
          <!-- 編集ボタン押す前　メールアドレスを表示 -->
          <div class="collapse show userMail">
            <h1 class="nagoyameshi-edit-user-info-value"><%= @user.email %></h1>
          </div>
          <!-- 編集ボタン押した後　メールアドレス編集フォームを表示 -->
          <div class="collapse editUserMail">
            <%=
              f.email_field :email,
              class: "form-control",
              autofocus: "true",
              required: "true",
              autocomplete: "on",
              placeholder: "メールアドレスを入力"
            %>
            <%= f.submit "保存", class: "btn nagoyameshi-submit-button mt-2 w-25" %>

            <% if @user.errors.messages[:email].present? %>
              <span class="invalid-feedback" role="alert">
                <strong>メールアドレスを入力してください</strong>
              </span>
            <% end %>
          </div>
        </div>
        <hr>
      <% end %>
      <% if @user.premium_end_date.present? && @user.premium_end_date > Time.now %>
        <%= link_to 'プレミアムプランを停止する', premium_cancel_users_path %>
      <% end %>
      <%= link_to '退会する', unsubscribe_users_path %>

    </div>
  </div>
</div>

<!-- onClick時の処理 -->
<script type="text/javascript">
  let switchEditUserInfo = (textClass, inputClass, labelClass) => {
    if ($(textClass).css('display') == 'block') {
      $(labelClass).text("キャンセル");
      $(textClass).collapse('hide');
      $(inputClass).collapse('show');
    } else {
      $(labelClass).text("編集");
      $(textClass).collapse('show');
      $(inputClass).collapse('hide');
    }
  }
</script>
